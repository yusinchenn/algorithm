<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplex Noise æ¼”ç®—æ³•æ·±åº¦è§£æ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js"></script>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --accent-color: #4CAF50;
            --text-main: #e0e0e0;
            --text-dim: #a0a0a0;
            --code-bg: #2d2d2d;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            line-height: 1.6;
        }

        /* ä½ˆå±€å®¹å™¨ */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ç« ç¯€æ¨£å¼ */
        section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        h1, h2 {
            margin-top: 0;
            color: #fff;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: -webkit-linear-gradient(45deg, #4CAF50, #2196F3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        h2 {
            border-left: 5px solid var(--accent-color);
            padding-left: 15px;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }

        p { color: var(--text-dim); }

        /* ç¨‹å¼ç¢¼å€å¡Š */
        pre {
            background: var(--code-bg);
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            color: #f8f8f2;
            font-family: 'Consolas', monospace;
            border: 1px solid #444;
        }
        .code-comment { color: #6272a4; }
        .code-keyword { color: #ff79c6; }
        .code-func { color: #50fa7b; }

        /* è¦–è¦ºåŒ– Canvas */
        .canvas-wrapper {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        canvas {
            background-color: #000;
            width: 100%;
            max-width: 500px; /* é™åˆ¶æœ€å¤§å¯¬åº¦ */
            height: auto;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            image-rendering: pixelated; 
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .control-group {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
        }

        label {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 8px;
        }

        input[type=range] {
            width: 100%;
            cursor: pointer;
            accent-color: var(--accent-color);
        }

        .explanation {
            font-size: 0.85em;
            color: #888;
            margin-top: 5px;
        }

        /* é€£çµæŒ‰éˆ• */
        .btn-link {
            display: block;
            width: 100%;
            padding: 20px;
            text-align: center;
            background: linear-gradient(90deg, #2196F3, #21CBF3);
            color: white;
            text-decoration: none;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(33, 150, 243, 0.4);
        }

        /* æ‰‹æ©Ÿç‰ˆé©é… */
        @media (max-width: 600px) {
            .controls { grid-template-columns: 1fr; }
            h1 { font-size: 2rem; }
            section { padding: 20px; }
        }
    </style>
</head>
<body>

    <div class="container">
        
        <header>
            <h1>Simplex Noise å¯¦é©—å®¤</h1>
            <p style="text-align: center;">å¾åŸç†ã€ç¨‹å¼ç¢¼åˆ°è¦–è¦ºåŒ–çš„å®Œæ•´æŒ‡å—</p>
        </header>

        <section id="intro">
            <h2>1. ä»€éº¼æ˜¯ Simplex Noiseï¼Ÿ</h2>
            <p>åœ¨è‡ªç„¶ç•Œä¸­ï¼Œå¹¾ä¹æ²’æœ‰æ±è¥¿æ˜¯å®Œå…¨éš¨æ©Ÿçš„ï¼ˆWhite Noiseï¼‰ã€‚é›²æœµçš„å½¢ç‹€ã€å±±è„ˆçš„èµ·ä¼ã€å¤§ç†çŸ³çš„ç´‹è·¯ï¼Œå®ƒå€‘éƒ½æ˜¯é€£çºŒä¸”æ¼¸è®Šçš„ã€‚</p>
            <p><strong>Simplex Noise</strong> æ˜¯ç”± Ken Perlin æ”¹è‰¯è‡ª Perlin Noise çš„ä¸€ç¨®æ¢¯åº¦é›œè¨Šæ¼”ç®—æ³•ã€‚å®ƒçš„ç‰¹é»åŒ…æ‹¬ï¼š</p>
            <ul>
                <li><strong>å¹³æ»‘æ€§ (Coherence)ï¼š</strong> æ•¸å€¼ä¸æœƒåŠ‡çƒˆè·³å‹•ï¼Œè€Œæ˜¯å¹³æ»‘éæ¸¡ã€‚</li>
                <li><strong>é«˜æ•ˆèƒ½ï¼š</strong> é‹ç®—è¤‡é›œåº¦ç‚º $O(n^2)$ï¼Œæ¯”å‚³çµ± Perlin Noise æ›´å¿«ï¼Œç‰¹åˆ¥æ˜¯åœ¨é«˜ç¶­åº¦é‹ç®—ä¸­ã€‚</li>
                <li><strong>ç„¡æ–¹æ ¼æ„Ÿï¼š</strong> ä½¿ç”¨ä¸‰è§’å½¢ï¼ˆ2Dï¼‰æˆ–å››é¢é«”ï¼ˆ3Dï¼‰ç¶²æ ¼ï¼Œæ¸›å°‘äº†è¦–è¦ºä¸Šçš„æ£‹ç›¤æ ¼ç‘•ç–µã€‚</li>
            </ul>
        </section>

        <section id="code">
            <h2>2. æ ¸å¿ƒç¨‹å¼ç¢¼é‚è¼¯</h2>
            <p>å–®ç´”å‘¼å«ä¸€æ¬¡ Noise å‡½æ•¸é€šå¸¸åªèƒ½å¾—åˆ°æ¨¡ç³Šçš„åœ˜å¡Šã€‚è¦ç”Ÿæˆç´°ç¯€è±å¯Œçš„åœ°å½¢ï¼Œæˆ‘å€‘éœ€è¦ä½¿ç”¨<strong>ã€Œç¢å½¢é›œè¨Š (Fractal Noise)ã€</strong>ï¼Œä¹Ÿå°±æ˜¯å°‡å¤šå±¤ä¸åŒé »ç‡çš„ Noise ç–ŠåŠ åœ¨ä¸€èµ·ã€‚</p>
            
            <pre><code><span class="code-comment">// è™›æ“¬ç¢¼ç¯„ä¾‹ï¼šè¨ˆç®—æŸå€‹åƒç´ çš„é«˜åº¦å€¼</span>
<span class="code-keyword">function</span> <span class="code-func">getFractalNoise</span>(x, y) {
    let elevation = 0;
    let amplitude = 1;  <span class="code-comment">// æŒ¯å¹…ï¼ˆå½±éŸ¿åŠ›ï¼‰</span>
    let frequency = 1;  <span class="code-comment">// é »ç‡ï¼ˆå¯†é›†åº¦ï¼‰</span>

    <span class="code-comment">// ç–ŠåŠ  4 å±¤ (Octaves)</span>
    <span class="code-keyword">for</span> (let i = 0; i < 4; i++) {
        <span class="code-comment">// æ ¸å¿ƒï¼šç´¯åŠ ä¸åŒé »ç‡çš„é›œè¨Š</span>
        elevation += <span class="code-func">noise</span>(x * frequency, y * frequency) * amplitude;
        
        amplitude *= 0.5; <span class="code-comment">// æ¯ä¸€å±¤å½±éŸ¿åŠ›æ¸›åŠ</span>
        frequency *= 2;   <span class="code-comment">// æ¯ä¸€å±¤ç´°ç¯€åŠ å€</span>
    }

    <span class="code-keyword">return</span> elevation;
}</code></pre>
            <p>é€™å€‹æŠ€å·§è®“æˆ‘å€‘åŒæ™‚æ“æœ‰äº†ã€Œå¤§çš„å±±é«”å½¢ç‹€ã€ï¼ˆä½é »å±¤ï¼‰å’Œã€Œåœ°è¡¨çš„å²©çŸ³ç´°ç¯€ã€ï¼ˆé«˜é »å±¤ï¼‰ã€‚</p>
        </section>

        <section id="demo-cloud">
            <h2>3. å‹•æ…‹é›²å±¤è¦–è¦ºåŒ–</h2>
            <p>è§€å¯Ÿ Simplex Noise å¦‚ä½•æ¨¡æ“¬çœŸå¯¦çš„é›²å±¤æµå‹•ã€‚ä½¿ç”¨æ™‚é–“ä½œç‚ºç¬¬ä¸‰ç¶­åº¦ï¼Œå‰µé€ å‡ºé€£çºŒè®ŠåŒ–çš„è‡ªç„¶æ•ˆæœã€‚</p>

            <div class="canvas-wrapper">
                <canvas id="cloudCanvas" width="400" height="400"></canvas>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>è¦–é‡ç¸®æ”¾ (Zoom) <span id="val-cloud-zoom">50</span></label>
                    <input type="range" id="cloud-zoom" min="10" max="150" value="50">
                    <div class="explanation">é¡ä¼¼ç›¸æ©Ÿè®Šç„¦ã€‚æ•¸å€¼è¶Šå¤§ï¼Œçœ‹åˆ°çš„ç¯„åœè¶Šå»£ï¼Œé›²å±¤è¶Šå¯†é›†ã€‚</div>
                </div>

                <div class="control-group">
                    <label>ç´°ç¯€å±¤æ•¸ (Octaves) <span id="val-cloud-octaves">4</span></label>
                    <input type="range" id="cloud-octaves" min="1" max="8" value="4" step="1">
                    <div class="explanation">ç–ŠåŠ çš„å±¤æ•¸ã€‚å±¤æ•¸è¶Šå¤šï¼Œé›²æœµé‚Šç·£è¶Šç´°ç·»ã€‚</div>
                </div>

                <div class="control-group">
                    <label>æµå‹•é€Ÿåº¦ (Speed) <span id="val-cloud-speed">1</span></label>
                    <input type="range" id="cloud-speed" min="0" max="5" value="1" step="0.1">
                    <div class="explanation">å°‡æ™‚é–“ä½œç‚º Z è»¸å‚³å…¥ï¼Œæ¨¡æ“¬é›²æœµçš„å‹•æ…‹æµå‹•ã€‚</div>
                </div>

                <div class="control-group">
                    <label>é›²å±¤å°æ¯” (Contrast) <span id="val-cloud-contrast">1.2</span></label>
                    <input type="range" id="cloud-contrast" min="0.5" max="3" value="1.2" step="0.1">
                    <div class="explanation">å¢å¼·æ¿ƒæ·¡å·®ç•°ï¼Œè®“é›²å±¤æ›´ç«‹é«”ã€‚</div>
                </div>
            </div>
        </section>

        <section id="demo-terrain">
            <h2>4. éœæ…‹åœ°å½¢è¦–è¦ºåŒ–</h2>
            <p>ä½¿ç”¨ç›¸åŒçš„æ¼”ç®—æ³•ç”Ÿæˆç¨‹åºåŒ–åœ°å½¢ã€‚å¾æ·±æµ·åˆ°é›ªå±±ï¼Œæ‰€æœ‰é¡è‰²éƒ½ç”±é«˜åº¦å€¼è‡ªå‹•æ±ºå®šã€‚</p>

            <div class="canvas-wrapper">
                <canvas id="terrainCanvas" width="400" height="400"></canvas>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>è¦–é‡ç¸®æ”¾ (Zoom) <span id="val-terrain-zoom">50</span></label>
                    <input type="range" id="terrain-zoom" min="10" max="150" value="50">
                    <div class="explanation">é¡ä¼¼ç›¸æ©Ÿè®Šç„¦ã€‚æ•¸å€¼è¶Šå¤§ï¼Œçœ‹åˆ°çš„ç¯„åœè¶Šå»£ï¼Œåœ°å½¢è¶Šå¯†é›†ã€‚</div>
                </div>

                <div class="control-group">
                    <label>ç´°ç¯€å±¤æ•¸ (Octaves) <span id="val-terrain-octaves">4</span></label>
                    <input type="range" id="terrain-octaves" min="1" max="8" value="4" step="1">
                    <div class="explanation">ç–ŠåŠ çš„å±¤æ•¸ã€‚å±¤æ•¸è¶Šå¤šï¼Œåœ°å½¢ç´°ç¯€è¶Šè±å¯Œã€‚</div>
                </div>

                <div class="control-group">
                    <label>åœ°å½¢å°æ¯” (Contrast) <span id="val-terrain-contrast">1</span></label>
                    <input type="range" id="terrain-contrast" min="0.5" max="3" value="1" step="0.1">
                    <div class="explanation">å¢å¼·é«˜ä½å·®ï¼Œè®“å±±æ›´æ˜é¡¯ã€‚</div>
                </div>

                <div class="control-group">
                    <label>åœ°å½¢ç¨®å­ (Seed) <span id="val-terrain-seed">0</span></label>
                    <input type="range" id="terrain-seed" min="0" max="100" value="0" step="1">
                    <div class="explanation">æ”¹è®Šéš¨æ©Ÿç¨®å­ï¼Œç”Ÿæˆä¸åŒçš„åœ°å½¢ã€‚</div>
                </div>
            </div>
        </section>

        <section id="application">
            <h2>5. å¯¦éš›æ‡‰ç”¨é«”é©—</h2>
            <p>äº†è§£äº†åŸç†ï¼Œè®“æˆ‘å€‘çœ‹çœ‹å®ƒåœ¨éŠæˆ²ä¸­æ˜¯å¦‚ä½•é‹ä½œçš„ã€‚åœ¨ä¸‹æ–¹çš„ç¯„ä¾‹ä¸­ï¼Œæˆ‘å€‘ä½¿ç”¨ <strong>1D Simplex Noise</strong> ä¾†å³æ™‚ç”Ÿæˆç„¡é™çš„æ´ç©´åœ°å½¢ã€‚</p>
            
            <a href="game.html" class="btn-link" target="_blank">
                ğŸ® å•Ÿå‹•ç„¡é™é£›è¡ŒéŠæˆ² <br>
                <span style="font-size: 0.8rem; font-weight: normal; opacity: 0.9;">(é»æ“Šé–‹å•Ÿæ–°åˆ†é )</span>
            </a>
            <p style="text-align: center; margin-top: 10px;">
                æç¤ºï¼šè©²éŠæˆ²æ²’æœ‰å„²å­˜ä»»ä½•åœ°åœ–æª”ï¼Œæ‰€æœ‰è·¯å¾‘éƒ½æ˜¯ç”±æ•¸å­¸å…¬å¼ç•¶ä¸‹ç®—å‡ºä¾†çš„ã€‚
            </p>
        </section>

    </div>

    <script>
        // ==================== é›²å±¤è¦–è¦ºåŒ– ====================
        const cloudCanvas = document.getElementById('cloudCanvas');
        const cloudCtx = cloudCanvas.getContext('2d');
        const cloudSimplex = new SimplexNoise();

        const cloudInputs = {
            zoom: document.getElementById('cloud-zoom'),
            octaves: document.getElementById('cloud-octaves'),
            speed: document.getElementById('cloud-speed'),
            contrast: document.getElementById('cloud-contrast')
        };

        let cloudTime = 0;

        function updateCloudDisplay() {
            document.getElementById('val-cloud-zoom').innerText = cloudInputs.zoom.value;
            document.getElementById('val-cloud-octaves').innerText = cloudInputs.octaves.value;
            document.getElementById('val-cloud-speed').innerText = cloudInputs.speed.value;
            document.getElementById('val-cloud-contrast').innerText = cloudInputs.contrast.value;
        }

        function drawCloud() {
            const width = cloudCanvas.width;
            const height = cloudCanvas.height;
            const imageData = cloudCtx.createImageData(width, height);
            const data = imageData.data;

            const zoom = parseInt(cloudInputs.zoom.value);
            const octaves = parseInt(cloudInputs.octaves.value);
            const speed = parseFloat(cloudInputs.speed.value);
            const contrast = parseFloat(cloudInputs.contrast.value);

            // æ›´æ–°æ™‚é–“
            cloudTime += speed * 0.01;

            // åƒç´ è™•ç†å¾ªç’°
            for (let x = 0; x < width; x++) {
                for (let y = 0; y < height; y++) {

                    let noiseValue = 0;
                    let amplitude = 1;
                    let frequency = 1;
                    let maxValue = 0;

                    // ç–ŠåŠ  Octaves
                    for(let i = 0; i < octaves; i++) {
                        noiseValue += cloudSimplex.noise3D(
                            (x / zoom) * frequency,
                            (y / zoom) * frequency,
                            cloudTime
                        ) * amplitude;

                        maxValue += amplitude;
                        amplitude *= 0.5;
                        frequency *= 2;
                    }

                    noiseValue = noiseValue / maxValue; // æ­£è¦åŒ– -1 ~ 1

                    // é›²å±¤é¡è‰²è¨ˆç®—ï¼ˆç™½è‰²åˆ°æ·±ç°è‰²ï¼‰
                    let colorVal = (noiseValue * contrast + 1) * 128;
                    colorVal = Math.max(0, Math.min(255, colorVal));

                    const cell = (x + y * width) * 4;

                    // é›²å±¤è‘—è‰²ï¼ˆå¾æ·±ç°åˆ°ç™½è‰²ï¼Œå¸¶é»è—è‰²èª¿ï¼‰
                    const skyBlue = Math.min(255, colorVal + 40);
                    data[cell] = colorVal;           // R
                    data[cell+1] = colorVal;         // G
                    data[cell+2] = skyBlue;          // B
                    data[cell + 3] = 255;            // Alpha
                }
            }

            cloudCtx.putImageData(imageData, 0, 0);
            updateCloudDisplay();
            requestAnimationFrame(drawCloud);
        }

        // ==================== åœ°å½¢è¦–è¦ºåŒ– ====================
        const terrainCanvas = document.getElementById('terrainCanvas');
        const terrainCtx = terrainCanvas.getContext('2d');
        const terrainSimplex = new SimplexNoise();

        const terrainInputs = {
            zoom: document.getElementById('terrain-zoom'),
            octaves: document.getElementById('terrain-octaves'),
            contrast: document.getElementById('terrain-contrast'),
            seed: document.getElementById('terrain-seed')
        };

        function updateTerrainDisplay() {
            document.getElementById('val-terrain-zoom').innerText = terrainInputs.zoom.value;
            document.getElementById('val-terrain-octaves').innerText = terrainInputs.octaves.value;
            document.getElementById('val-terrain-contrast').innerText = terrainInputs.contrast.value;
            document.getElementById('val-terrain-seed').innerText = terrainInputs.seed.value;
        }

        function drawTerrain() {
            const width = terrainCanvas.width;
            const height = terrainCanvas.height;
            const imageData = terrainCtx.createImageData(width, height);
            const data = imageData.data;

            const zoom = parseInt(terrainInputs.zoom.value);
            const octaves = parseInt(terrainInputs.octaves.value);
            const contrast = parseFloat(terrainInputs.contrast.value);
            const seed = parseFloat(terrainInputs.seed.value);

            // åƒç´ è™•ç†å¾ªç’°
            for (let x = 0; x < width; x++) {
                for (let y = 0; y < height; y++) {

                    let noiseValue = 0;
                    let amplitude = 1;
                    let frequency = 1;
                    let maxValue = 0;

                    // ç–ŠåŠ  Octaves
                    for(let i = 0; i < octaves; i++) {
                        noiseValue += terrainSimplex.noise3D(
                            (x / zoom) * frequency,
                            (y / zoom) * frequency,
                            seed // ä½¿ç”¨å›ºå®šçš„ç¨®å­å€¼è€Œéæ™‚é–“
                        ) * amplitude;

                        maxValue += amplitude;
                        amplitude *= 0.5;
                        frequency *= 2;
                    }

                    noiseValue = noiseValue / maxValue; // æ­£è¦åŒ– -1 ~ 1

                    // é¡è‰²è¨ˆç®—
                    let colorVal = (noiseValue * contrast + 1) * 128;
                    colorVal = Math.max(0, Math.min(255, colorVal));

                    const cell = (x + y * width) * 4;

                    // åœ°å½¢ä¸Šè‰²
                    if(colorVal < 100) { // æ·±æ°´
                        data[cell] = 10;
                        data[cell+1] = 30 + colorVal;
                        data[cell+2] = 100 + colorVal;
                    } else if (colorVal < 140) { // æ·ºæ°´/æ²™ç˜
                        data[cell] = colorVal;
                        data[cell+1] = colorVal + 20;
                        data[cell+2] = 180;
                    } else if (colorVal < 200) { // è‰åœ°
                        data[cell] = 50;
                        data[cell+1] = colorVal;
                        data[cell+2] = 50;
                    } else { // é›ªåœ°
                        data[cell] = colorVal;
                        data[cell+1] = colorVal;
                        data[cell+2] = colorVal;
                    }

                    data[cell + 3] = 255; // Alpha
                }
            }

            terrainCtx.putImageData(imageData, 0, 0);
            updateTerrainDisplay();
        }

        // ç›£è½åœ°å½¢æ§åˆ¶é …è®ŠåŒ–
        Object.values(terrainInputs).forEach(input => {
            input.addEventListener('input', drawTerrain);
        });

        // å•Ÿå‹•
        drawCloud();  // é›²å±¤æŒçºŒå‹•ç•«
        drawTerrain(); // åœ°å½¢ç¹ªè£½ä¸€æ¬¡ï¼ˆä¹‹å¾Œç”±ä½¿ç”¨è€…äº’å‹•æ›´æ–°ï¼‰
    </script>
</body>
</html>